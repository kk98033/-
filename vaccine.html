<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COVID-19</title>

    <script src="https://kit.fontawesome.com/c480c03de3.js" crossorigin="anonymous"></script>
    
    <link rel="stylesheet" href="styles/top_bar.css">
    <link rel="stylesheet" href="styles/side_page.css">
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="styles/bottom_bar.css">
    <link rel="stylesheet" href="styles/title_page.css">
    <link rel="stylesheet" href="styles/toggle.css">
    
    <link rel="stylesheet" href="styles/parallax_style.css">

    <!-- Live 2D -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
</head>
<body id="body" onmousedown="CloseSideClickingOuside(event)">
    <div id="overlay"></div>
    <div id="sidePageId" class="sidePage menu-item">
        <a href="javascript:void(0)" class="closeBtn" onclick="CloseSidePage()">&times;</a>
        <a href="https://www.cdc.gov.tw/" target="blank">&#8250; 疾管署網站</a>
        <a href="https://www.who.int/" target="blank">&#8250; 世界衛生組織網站</a>
        <a href="taiwan-data.html">&#8250; 臺灣確診數據</a>
        <a href="world-data.html">&#8250; 世界確診數據</a>
        <a href="vaccine.html">&#8250; 疫苗介紹＆預約</a>
        <a href="game.html">&#8250; 小遊戲</a>
        <a href="video.html">&#8250; COVID-19相關影片</a>
        <a href="reference.html">&#8250; 參考資料</a>
    </div>
    
    <div id="topBar" class="topBar" style="z-index: 9999;">
        <a id="btn" style="margin-left: 25px;margin-top: 20px; margin-right: 40px; cursor: pointer;" onclick="CheckState()"><div class="bar" id="bar" style="position: fixed; margin-left: 10px;"></div></a>
        <div class="menu-item-home"><a href="index.html">Home</a></div>
        <div class="menu-item-friends"><a href="about-us.html">About Us</a></div>
        <div class="menu-item-about"><a href="donate.html">Donate</a></div>
        <div class="dropdown" onmouseover="ShowDropdown()" onmouseout="CloseDropdown()">
            <button class="dropbtn menu-switch-language" onclick="ShowDropdown()">English
              <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content" id="dropdown">
                <a style="margin: 0; text-align: center;" href="#">Chinese</a>
            </div>
        </div> 
        <label class="switch">
            <input type="checkbox">
            <span class="switchSlider round"></span>
        </label>
    </div>

    <a class="backToTop" id="backToTop" href="#head">Top</a>

    <header id="head">
        <div class="bigTitle">
            <div>Title</div>
            <!-- <div class="headerUnderLine"></div> -->
            <div class="downBtn translate" data-speed="0.1"><a style="opacity: .7;" href="#section1"><i class="fas fa-chevron-down"></i></a></div>
        </div>
        <div class="TWbackgroundImg"></div>
    </header>

    <section class="section" id="section1">
        <div class="pageTitle">
            <div>Title</div>
            <div class="underLine"></div>
        </div>
        <div>點擊可以得到各縣市詳細資料</div>
        <div id="updateTime">Update time: </div>

        <div class="chartContainer">
            <div id="total-data-chart" class="chart"></div>
        </div>

        <div id="chartCityId">City</div>

        <div class="chartContainer">
            <div id="cityChart1" class="chart"></div>
        </div>
    </section>

    <section class="section">
        <div class="pageTitle">
            <div>Title</div>
            <div class="underLine"></div>
        </div>

        <div class="chartContainer">
            <div id="vaccine-type-data-chart" class="chart"></div>
        </div>
    </section>

    <section class="section">
        <div>Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequuntur iste sapiente ullam laboriosam deleniti blanditiis id alias nam facilis totam reiciendis, ipsum illum dignissimos? Laborum voluptatibus asperiores quis deleniti id.</div>
        <div>Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequuntur iste sapiente ullam laboriosam deleniti blanditiis id alias nam facilis totam reiciendis, ipsum illum dignissimos? Laborum voluptatibus asperiores quis deleniti id.</div>
        <div>Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequuntur iste sapiente ullam laboriosam deleniti blanditiis id alias nam facilis totam reiciendis, ipsum illum dignissimos? Laborum voluptatibus asperiores quis deleniti id.</div>
        <div>Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequuntur iste sapiente ullam laboriosam deleniti blanditiis id alias nam facilis totam reiciendis, ipsum illum dignissimos? Laborum voluptatibus asperiores quis deleniti id.</div>
        <div>Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequuntur iste sapiente ullam laboriosam deleniti blanditiis id alias nam facilis totam reiciendis, ipsum illum dignissimos? Laborum voluptatibus asperiores quis deleniti id.</div>
        <div>Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequuntur iste sapiente ullam laboriosam deleniti blanditiis id alias nam facilis totam reiciendis, ipsum illum dignissimos? Laborum voluptatibus asperiores quis deleniti id.</div>
        <div>Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequuntur iste sapiente ullam laboriosam deleniti blanditiis id alias nam facilis totam reiciendis, ipsum illum dignissimos? Laborum voluptatibus asperiores quis deleniti id.</div>
        <div>Lorem ipsum dolor sit amet consectetur adipisicing elit. Consequuntur iste sapiente ullam laboriosam deleniti blanditiis id alias nam facilis totam reiciendis, ipsum illum dignissimos? Laborum voluptatibus asperiores quis deleniti id.</div>
    </section>


    <section class="bottom">
        <div class="bottomText" style="padding-top: 0;"><b>Contact Me</b></div>
        <div id="bottomTextHref">
            <a href="mailto:a8829037@gmail.com" target="blank" class="bottomText" style="display: inline; padding-right: 10px;">Email</a>
            <a href="https://github.com/kk98033" class="bottomText" target="blank" style="display: inline; padding-right: 10px;">GitHub</a>
            <a href="https://www.youtube.com/channel/UCubeo2tni91PwEGC22a11Kg" class="bottomText" target="blank" style="display: inline; padding-right: 10px;">YouTube</a>
            <a href="https://steamcommunity.com/id/IddleFromTaiwan/" class="bottomText" target="blank" style="display: inline; padding-right: 10px;">Steam</a>
        </div>
        <div class="bottomText" style="padding: 0;">所有圖片皆作為作業練習用途，均不屬於我</div>
        <div class="bottomText">Copyright &#9400 2021 ChiaYuYang. All Rights Reserved</div>
    </section>

    <!-- Live 2D -->
    <script src="live2d-widget-master_2/autoload.js"></script>

    <!-- Parallax -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="JS/parallax.js"></script>

    <!-- Stander page item -->
    <script src="JS/side_page.js"></script>
    <script src="JS/top_bar.js"></script>

    <!--Firebase Libraries-->
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script> 
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyB_xpBdbHpt-apQ8ZXl2lgDb5wlE5GU7BE",
            authDomain: "covid-19-website-b68f9.firebaseapp.com",
            databaseURL: "https://covid-19-website-b68f9-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "covid-19-website-b68f9",
            storageBucket: "covid-19-website-b68f9.appspot.com",
            messagingSenderId: "631482638390",
            appId: "1:631482638390:web:42c2a2b67917ec69dcb897",
            measurementId: "G-VCQ5PVZM5R"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        /* Heheehe I will make your brain explode:) */
        var vaccineDic = {};
        // var totalData = [['Gerne', '第一劑', '第二劑', '第三劑', { role: 'annotation' } ]];
        var totalData = {
            cols: [
                {label: 'x', type: 'string'},
                {label: '第二劑', type: 'number'},
                {label: '第一劑', type: 'number'},
            ],
            rows: []
        };
        var allCityData = {};
        database.ref("Vaccine/").once('value', snapshot => {
            snapshot.forEach(childSnapshot => {
                let value = childSnapshot.val()
                let key = childSnapshot.key
                vaccineDic[key] = value

                // totalData.push(OrganizeAllData(key, value))
                if(key != 'time'){
                    totalData['rows'].push(OrganizeAllData(key, value))
                    allCityData[key] = OrgainizeCityData(key, value)
                }else if(key === 'time'){
                    console.log(value)
                    ShowChartText('updateTime', 'Update time: ' + value);
                }
            });
            console.log(totalData);
            console.log(allCityData);
            
            google.charts.setOnLoadCallback(DrawStuff(totalData, allCityData, 'total-data-chart', 0));
            google.charts.setOnLoadCallback(DrawStuff(totalData, allCityData['全國'], 'cityChart1', 1));
            ShowChartText('chartCityId', '全國');
        });
        
        var vacTypeData = [['人數', '第一劑', '第二劑', '總人數']];
        database.ref("Vaccine_type/").once('value', snapshot => {
            snapshot.forEach(childSnapshot => {
                let value = childSnapshot.val()
                let key = childSnapshot.key
                
                if(key != 'time'){
                    vacTypeData.push(OrganizeVaccineTypeData(key, value))
                }
            });
            console.log(vacTypeData);
            google.charts.setOnLoadCallback(DrawStuff(totalData, vacTypeData, 'vaccine-type-data-chart', 1));
        });
        
        function OrganizeVaccineTypeData(key, value){
            let vacTypeData = [key, value[0], value[1], value[2]];
            // vacTypeData.push(.concat().concat());

            return vacTypeData;
        }

        function OrganizeAllData(key, value){
            // let allData = [key];
            // allData = allData.concat(value["總計"].concat(['']));
            let first = value["總計"][0];
            let sec = value["總計"][1];
            let allData = {c: [{v: key}, {v: sec}, {v: -first, f: first}]}
            
            return allData;
        }
        
        function OrgainizeCityData(key, value){
            let cityData = [[key, '第一劑', '第二劑', '第三劑']];
            cityData.push(
                ["12-17歲", value["12-17歲"][0]].concat(value["12-17歲"][1]).concat(value["12-17歲"][2])
            );
            cityData.push(
                ["18-29歲", value["18-29歲"][0]].concat(value["18-29歲"][1]).concat(value["18-29歲"][2])
            );
            cityData.push(
                ["30-49歲", value["30-49歲"][0]].concat(value["30-49歲"][1]).concat(value["30-49歲"][2])
            );
            cityData.push(
                ["50-64歲", value["50-64歲"][0]].concat(value["50-64歲"][1]).concat(value["50-64歲"][2])
            );
            cityData.push(
                ["50-64歲", value["50-64歲"][0]].concat(value["50-64歲"][1]).concat(value["50-64歲"][2])
            );
            cityData.push(
                ["50-64歲", value["50-64歲"][0]].concat(value["50-64歲"][1]).concat(value["50-64歲"][2])
            );

            return cityData;
        }
    </script>

    <!-- Google Chart -->
    <script type="text/javascript"src='https://www.gstatic.com/charts/loader.js'></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['bar']});
        google.charts.load("current", {'packages': ["corechart"]});

        function DrawStuff(totalData, allCityData, id, type){
            if(type === 0){
                // var data1 = google.visualization.arrayToDataTable(totalData);
                var data1 = new google.visualization.DataTable(totalData);
    
                var options1 = {
                    title: '疫苗接種率',
                    subtitle: '個別縣市',
                    isStacked: true,
                    
                    legend: { 
                        position: 'top', 
                        maxLines: 4, 
                        textStyle: {color: 'white'} 
                    },
                    vAxis: { 
                        title: '城市',
                        titleTextStyle: { color: '#FFF' },
                        textStyle: { color: '#FFF' } 
                    },
                    hAxis: { 
                        textStyle: { color: '#FFF' },
                        ticks: [
                            {v: -100, f: '100%'},
                            {v: -50, f: '50%'},
                            {v: 0, f: '0%'},
                            {v: 50, f: '50%'},
                            {v: 100, f: '100%'},
                        ]
                    },
                    bar: { groupWidth: '80%' },
                    annotations: { textStyle: { color: '#FFF' } },
                    backgroundColor: { fill:'transparent' },
                    titleTextStyle: { color: 'white' },
                };
                
                var chart1 = new google.visualization.BarChart(document.getElementById(id))
                chart1.draw(data1, options1);
                
                var selectHandler = function(e){
                    var selectedItem = chart1.getSelection()[0];
                    if(selectedItem){
                        var selectedValue = data1.getValue(selectedItem.row, 0);
                        console.log(allCityData[selectedValue]);
                        google.charts.setOnLoadCallback(DrawStuff(totalData, allCityData[selectedValue], 'cityChart1', 1));
                        ShowChartText("chartCityId", selectedValue);
                    }
                }
                
                google.visualization.events.addListener(chart1, 'click', selectHandler);
                
            }else if(type === 1){
                var chartHeight = CheckWidth();

                var data2 = google.visualization.arrayToDataTable(allCityData);
                var options2 = {
                    title: '疫苗接種率',
                    
                    backgroundColor: { fill:'transparent' },
                    titleTextStyle: {color: 'white'},
                    chartArea: {
                        backgroundColor: 'transparent',
                    },
                    legend: { 
                        position: 'left', 
                        maxLines: 4, 
                        textStyle: {color: 'white'} 
                    },
                    vAxis: { textStyle: { color: '#FFF' } },
                    hAxis: { textStyle: { color: '#FFF' } },
                    height: chartHeight,
                };
        
                var chart2 = new google.charts.Bar(document.getElementById(id));
                chart2.draw(data2, google.charts.Bar.convertOptions(options2));
            }
        }

        function CheckWidth(){
            var width = window.screen.width;
                if(width >= 600){
                    var chartHeight = 800;
                }else{
                    var chartHeight = 300;
                }

            return chartHeight;
        }
    </script>

    <!-- Text -->
    <script>
        function ShowChartText(id, textContent){
            let text = document.getElementById(id);

            text.textContent = textContent;
            text.style.display = 'block';
        }
    </script>
</body>
</html>